require(["handlebars"],function(a){var c=a.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(a,c,g,q,d){return'\x3cdiv class\x3d"date-price unfetched"\x3e\x26nbsp;\x3c/div\x3e'},useData:!0});a.templates=a.templates||{};a.templates.priceContainer=c;a.partials=a.partials||{};a.partials.priceContainer=c});require(["handlebars"],function(a){var c=a.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(a,c,g,q,d){var h;return'\x3cspan class\x3d"visuallyhidden aria-text"\x3e'+a.escapeExpression((h=null!=(h=g.pricesFrom||(null!=c?c.pricesFrom:c))?h:g.helperMissing,"function"===typeof h?h.call(null!=c?c:{},{name:"pricesFrom",hash:{},data:d}):h))+'\x3c/span\x3e\n\x3cspan aria-hidden\x3d"true"\x3e'+a.escapeExpression((h=null!=(h=g.price||(null!=c?c.price:c))?h:g.helperMissing,"function"===typeof h?h.call(null!=c?c:{},{name:"price",hash:{},data:d}):h))+"\x3c/span\x3e\n"},useData:!0});a.templates=a.templates||{};a.templates.fareCalendarPrice=c;a.partials=a.partials||{};a.partials.fareCalendarPrice=c});require(["handlebars"],function(a){var c=a.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(a,c,g,q,d){return'\x3cdiv id\x3d"currency-banner-container"\x3e\n\x3c/div\x3e\n'},useData:!0});a.templates=a.templates||{};a.templates.currencyBannerExperiment=c;a.partials=a.partials||{};a.partials.currencyBannerExperiment=c});require(["handlebars"],function(a){var c=a.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(a,c,g,q,d){return'\x3cspan id\x3d"currency-banner-content" class\x3d"loading-prices"\x3e\n\t\x3cspan class\x3d" loader-primary loader-dark loader-static" aria-hidden\x3d"true"\x3e\x3c/span\x3e\n\x3c/span\x3e'},useData:!0});a.templates=a.templates||{};a.templates.currencyBannerLoader=c;a.partials=a.partials||{};a.partials.currencyBannerLoader=c});define("fareCalendarDatePicker-loc",function(){return{pricesFrom:"Prices from {{price}}",lowestPriceFrom:"Lowest price from {{price}}",oneWayBannerText:"Prices are one-way per person in {{currency}}.",roundTripBannerText:"Prices are round trip per person in {{currency}}."}});
define("fareCalendarDatePicker","jquery uitk underscore handlebars currencyBannerExp sfSelectedLobs fareCalendarActiveSearchParameterModel fareCalendarDatePicker-loc xdate FareCalendarService sfAbTest uitk_localized_priceApi".split(" "),function(a,c,h,m,g,q,d,u,n,x,y){var z={},A={},l,r=0,p=function(){var b=a(".datepicker-dropdown").find(".datepicker-cal-date"),e=m.partials.priceContainer();b.each(function(b,k){a(k).has(".date-price").length||a(k).append(e)});a(".date-price").on("click",function(e){e.stopPropagation();a(e.target).closest(".datepicker-cal-date").click()})},f=function(b){return h.chain(b).filter(function(e){var b="undefined"!==typeof a(e).data().month;e=a(e).is(":visible");return b&&e}).map(function(e){return a(e).data("month")}).uniq().value()},b=function(){var a="FareCalendar";d.isRoundtripFareCalendar&&(a=d.isDatePickerInbound?"RTFareCalendar.Inbound":"RTFareCalendar.Outbound");return a},E=function(k,e){var d=b(),c=e+".Flights."+d+".Coverage",g=k.find(".datepicker-cal-date:not(.disabled)"),l=function(a){return h.find([{lower:100,omnitureString:"100"},{lower:90,omnitureString:"90.99"},{lower:80,omnitureString:"80.90"},{lower:70,omnitureString:"70.80"},{lower:50,omnitureString:"50.70"},{lower:0,omnitureString:"0.50"}],function(e){return a>=e.lower}).omnitureString};f(g).forEach(function(e){var b=(new n).setMonth(e).toString("MMMM"),d=h.chain(g).filter(function(b){return a(b).data().month===e}),k=d.value().length;d=d.filter(function(e){return 0<a(e).find("div:not(.no-price)").length}).value().length;var v=l(100*d/k);require("dctk/dctk",function(a){a.trackAction([c,b,v].join("."))})})},B=function(a,e){var d=b();var k=e.hasClass("cheapest")?"Cheapest":e.hasClass("low-price")?"LowPrice":e.data().price?"NotCheapest":"Empty";require("dctk/dctk",function(e){e.trackAction(a+".Flights."+d+".DateSelected."+k)})},J=function(b){a(".datepicker-cal-date:not(.disabled)").click(function(e){e=a(e.currentTarget).find(".date-price");if(0<e.length){B(b,e);var k=e.data().price;e=a("#fare-calendar-price");k?(0===e.length&&(e=a('\x3cinput type\x3d"hidden" id\x3d"fare-calendar-price" name\x3d"fareCalendarPrice" value\x3d""/\x3e'),a(".gcw-form.flights").append(e)),(d.isDatePickerOneWay||d.isDatePickerInboundWithRoundtripPricing)&&e.val(k),d.isDatePickerOutboundWithRoundtripPricing&&e.val(""),d.isDatePickerOutboundWithOnewayPricing&&(r=k),d.isDatePickerInboundWithOnewayPricing&&(0===r?e.remove():(k=r+k,e.val(k)))):(e.remove(),r=0)}})},F=function(b){var e=d.origin+"-"+d.destination,k=d.pageTypeAbbreviation,h=[],t=b.find(".datepicker-cal-date"),f=d.isOutboundDatePickerEmpty,q=d.isDatePickerOneWayPricing?u.oneWayBannerText:u.roundTripBannerText,B;if(d.isDatePickerInboundWithRoundtripPricing){var w=d.getOutboundDateForRoundtripSearch();var p=d.validateAgainstCurrentDate(w);if(f||p){g.reset();return}f=w.getMonth();w=w.getDate();if("undefined"===typeof l[e][f]||"undefined"===typeof l[e][f][w]){g.reset();return}var n=l[e][f][w].inboundOptions}else n=l[e];t.each(function(e,b){var d=a(b);d.find(".date-price").removeClass("unfetched");d.find(".date-price").html("\x26nbsp;").addClass("no-price")});"undefined"===typeof n?(g.reset(),E(b,k)):(t.each(function(e,b){var d=a(b);var k=d.data();var f=parseInt(k.month,10);k=parseInt(k.day,10);if("undefined"!==typeof n[f]&&"undefined"!==typeof n[f][k]){var t=n[f][k];var v=t.price;t=t.currencyCode}v&&t&&(v=Math.ceil(v),k=c.utils.createLocalizedPrice(v.toString(),window.locale,t).roundUp().format(),B=!0,g.displayTitle(t,q),d.find(".date-price").removeClass("no-price").html(m.partials.fareCalendarPrice({price:k,pricesFrom:u.pricesFrom.replace("{{price}}",k)})).attr("data-price",v),h.push({month:f,price:v}))}),B||g.reset(),D(h,b),E(b,k),J(k),g.applyFullColor())},K=h.once(function(){y.log(28917)}),D=function(a,e){var b=e.find(".datepicker-cal-date:not(.disabled)"),d=f(b);b=h.chain(a).filter(function(a){return a.month===d[0]||a.month===d[1]}).pluck("price").value();b.length&&L(b)},L=function(b){var e=h.min(b),d=Math.ceil(e+.05*e);b=h.uniq(h.filter(b,function(b){return b<=d&&b>e}));a(".datepicker-cal-date:not(.disabled) .date-price").removeClass("low-price cheapest");for(var k=0;k<b.length;k++)a('.datepicker-cal-date:not(.disabled) div[data-price\x3d"'+b[k]+'"]').addClass("low-price");a('.datepicker-cal-date:not(.disabled) div[data-price\x3d"'+e+'"]').addClass("cheapest")},G=function(a){var e=d.pageTypeAbbreviation,k=d.origin+"-"+d.destination,c=b();l=d.isDatePickerOneWayPricing?z:A;if(C.shouldMakeFareCalendarCall(d)){var f=x.getPricesPromise(d);require("dctk/dctk",function(b){b.trackAction(e+".Flights."+c+".v3")});f.done(function(b){C.updateDatepickerPriceMap(b.priceMap,k);F(a)}).fail(function(b){require("dctk/dctk",function(a){a.logging.logError("Error: fare calendar ",b.errorThrown,b.url,b.payload);a.trackAction(e+".Flights."+c+".Error."+b.status)});g.reset()})}else F(a)},H=function(b){a(".datepicker-dropdown").addClass("fare-calendar");p();c.publish("datepicker.calendar.view.updated",b)},I=function(b){"requestAnimationFrame"in window?requestAnimationFrame(function(){H(b);g.displayLoader(b)}):setTimeout(function(){H(b);g.displayLoader(b)},10)},M=function(b){a(".datepicker-paging").on("click",function(){I(b);"requestAnimationFrame"in window?requestAnimationFrame(function(){d.updateDatePickerRangeData(b)}):setTimeout(function(){d.updateDatePickerRangeData(b)},10)})},C={getDatePickerPriceMap:function(){return z},updateDatepickerPriceMap:function(b,a){var e=d.isDatePickerOneWayPricing;try{var c=b.FlightOfferSummaryList.FlightOfferSummary;c.forEach(function(b){var c=b.FlightPriceSummary.TotalPrice,k=b.FlightPriceSummary.CurrencyCode;var f=b.FlightProductSummaryList.FlightProductSummary;var g=new n(f[0].AirOriginDestinationList.AirOriginDestination[0].AirSegment[0].DepartureDateTime.split("T")[0]);b=g.getMonth();g=g.getDate();"undefined"===typeof l[a]&&(l[a]={});"undefined"===typeof l[a][b]&&(l[a][b]={});d.isDatePickerInboundWithRoundtripPricing||(l[a][b][g]={price:c,currencyCode:k});if(!e){f=f[f.length-1].AirOriginDestinationList.AirOriginDestination;f=f[f.length-1].AirSegment;var h=new n(f[0].DepartureDateTime.split("T")[0]);f=h.getMonth();h=h.getDate();"undefined"===typeof l[a][b][g]&&(l[a][b][g]={});"undefined"===typeof l[a][b][g].inboundOptions&&(l[a][b][g].inboundOptions={});"undefined"===typeof l[a][b][g].inboundOptions[f]&&(l[a][b][g].inboundOptions[f]={});l[a][b][g].inboundOptions[f][h]={price:c,currencyCode:k}}})}catch(t){require("dctk/dctk",function(b){b.logging.logError("Error: fare calendar: ",t.stack)})}},evaluateMapActualKeys:function(b,a,c,f){var e=d.isDatePickerInboundWithRoundtripPricing,g=b[a][c.getMonth()];b=b[a][f.getMonth()];a=g[c.getDate()];return e?Object.keys(a.inboundOptions[c.getMonth()]).length+Object.keys(a.inboundOptions[f.getMonth()]).length:Object.keys(g).length+Object.keys(b).length},shouldMakeFareCalendarCall:function(b){var a=b.origin+"-"+b.destination,c=new n(b.determineStartDate());b=new n(b.determineEndDate());var f=d.isDatePickerOneWayPricing,g=d.isDatePickerInboundWithRoundtripPricing,h=d.isOutboundDatePickerEmpty;var k="undefined"===typeof l[a]||"undefined"===typeof l[a][c.getMonth()]||"undefined"===typeof l[a][b.getMonth()];if(d.origin===d.destination||g&&(g=d.getOutboundDateForRoundtripSearch(),g=d.validateAgainstCurrentDate(g),h||g))return!1;if(f){if(k)return!0}else if(k||"undefined"===typeof l[a][c.getMonth()][c.getDate()]||"undefined"===typeof l[a][c.getMonth()][c.getDate()].inboundOptions[c.getMonth()]||"undefined"===typeof l[a][c.getMonth()][c.getDate()].inboundOptions[b.getMonth()])return!0;k=c.diffDays(b)+1;return.9>C.evaluateMapActualKeys(l,a,c,b)/k}};(function(){c.subscribe("datepicker.opened",function(b,c){var e=c.$datepicker;a(".datepicker-dropdown").removeClass("fare-calendar");if(d.validateSearchParameters()){var g=q.getSelectedLob();"flight"===g.searchType&&"roundtrip"===g.searchSubType&&K();d.validateDatePicker(e)&&(I(e),d.populateData(e))}});c.subscribe("datepicker.calendar.view.updated",
function(b,a){M(a)});c.subscribe("fareCalendarParameterModelUpdated",function(b,a){window.setTimeout(function(){d.validateModel()&&G(a)},100)});g.initialize()})();return C});require("fareCalendarDatePicker");define("currencyBannerExp",["jquery","underscore","uitk","handlebars"],function(a,c,h,m){return{experimentId:28390,isActiveExperiment:!0,state:"",token:null,selectors:{datePicker:".datepicker-dropdown.fare-calendar .datepicker-cal",inboundDatePickerHomePage:"#flight-returning-wrapper-hp-flight",inboundDatePickerLandingPage:"#flight-returning-wrapper-flp",currencyBannerContainer:"#currency-banner-container",currencyBannerContent:"#currency-banner-content"},$currencyBannerContainer:null,$currencyBannerContent:null,initialize:function(){a("body").addClass("exp28390-1")},displayLoader:function(c){(c.is(this.selectors.inboundDatePickerHomePage)||c.is(this.selectors.inboundDatePickerLandingPage))&&a(window).resize();this.isActiveExperiment&&(1>a(this.selectors.currencyBannerContainer).length&&(a(this.selectors.datePicker).before(m.partials.currencyBannerExperiment()),this.$currencyBannerContainer=a(this.selectors.currencyBannerContainer)),this.$currencyBannerContainer.html(m.partials.currencyBannerLoader()),this.state="loaderDisplayed")},displayTitle:function(c,h){if("titleDisplayed"!==this.state&&this.isActiveExperiment&&c){var d=h.replace("{{currency}}",c);this.$currencyBannerContent=a(this.selectors.currencyBannerContent);this.$currencyBannerContent.html(d).removeClass("loading-prices").addClass("title-displayed");this.state="titleDisplayed"}},applyFullColor:function(){this.$currencyBannerContent&&this.$currencyBannerContent.addClass("full-color-applied")},reset:function(){this.state="";this.$currencyBannerContainer&&this.$currencyBannerContainer.empty()}}});define("rateLimitExperiment",["sfAbTest","underscore"],function(a,c){var h={1:60,2:14,3:28},m={initialize:function(){var c=this;a.get(30752,!1,function(a){c.variant=a.value;0<a.value&&(c.isActive=!0)})},isRoundtripActive:function(){return this.isActive},getMaxRoundtripDateRangeDays:function(a){this.logExperiment();return 0<this.variant?h[this.variant]:a},logExperiment:c.once(function(){a.log(30752)})};m.initialize();return m});define("fareCalendarActiveSearchParameterModel","jquery underscore uitk sfSelectedLobs xdate rateLimitExperiment".split(" "),function(a,c,h,m,g,q){function d(b){return"true"===b.attr("data-is-roundtrip-pricing")||q.isRoundtripActive()}function u(b){return"true"===b.attr("data-is-oneway-pricing")}function n(b){return-1!==p.roundtripInboundDatepickerWrappers.indexOf(b[0].id)}function x(b){(b=-1!==p.roundtripOutboundDatepickerWrappers.indexOf(b[0].id))&&q.logExperiment();return b}function y(b){var a=b.getMonth();b=b.getDate();return(new g).getDate()===b&&(new g).getMonth()===a}function z(){var b=l();return""===a(p.roundtripOutboundInputFields[b]).val()}function A(){var b=l();b=a(p.roundtripOutboundInputFields[b]).val();return new g(b)}function l(){var b=!1;"undefined"!==typeof window&&window.launchPageType&&(b="flight"===window.launchPageType);return b?"LP":"HP"}function r(b){return a.ajax({url:"//expedia.com/api/v4/resolve/"+b+"?callback\x3d?\x26regiontype\x3d95\x26locale\x3d"+h.locale+"\x26lob\x3dFLIGHTS\x26format\x3djsonp\x26client\x3dFlights",dataType:"jsonp"})}var p={origin:"#flight-origin-hp-flight, #flight-origin-flp",destination:"#flight-destination-hp-flight, #flight-destination-flp",onewayDatepickerWrappers:["flight-departing-wrapper-single-hp-flight","flight-departing-wrapper-single-flp"],roundtripInboundDatepickerWrappers:["flight-returning-wrapper-hp-flight","flight-returning-wrapper-flp"],roundtripOutboundDatepickerWrappers:["flight-departing-wrapper-hp-flight","flight-departing-wrapper-flp"],roundtripOutboundInputFields:{HP:"#flight-departing-hp-flight",LP:"#flight-departing-flp"},preferredCabinClass:"#flight-advanced-preferred-class-hp-flight, #flight-advanced-preferred-class-flp",departureDatesPaging:".datepicker-paging",datepickerEnabledDates:".datepicker-cal-date:not(.disabled)"},f;return f={populateData:function(b){function d(b,a){try{var d=c.find(b.sr,function(b){return b.isWinner}).hierarchyInfo.airport.airportCode;f[a]!==d&&(f[a]=d)}catch(G){f[a]=""}}var g=a(p.origin).val(),h=a(p.destination).val();if(n(b)&&u(b)){var l=g;g=h;h=l}f.validateSearchParameters()&&a.when(r(g),r(h)).then(function(a,c){d(a[0],"origin");d(c[0],"destination");f.updateDatePickerRangeData(b)})},getOutboundDateForRoundtripSearch:A,validateAgainstCurrentDate:function(b){return b.valid()?y(b):!1},validateSearchParameters:function(){var b=a(p.origin).val(),c=a(p.destination).val();return-1===["first","business","premium"].indexOf(a(p.preferredCabinClass).val())&&b&&0<b.length&&c&&0<c.length},validateDatePicker:function(b){var a=m.getSelectedLob();return"flight"===a.searchType&&"oneway"===a.searchSubType||d(b)||u(b)},validateModel:function(){return void 0!==f.origin&&void 0!==f.destination&&void 0!==f.calendarEndDate&&void 0!==f.calendarStartDate},determineStartDate:function(){var b=f.calendarStartDate;"undefined"!==typeof f.roundtripDateRangeStart&&(b=f.roundtripDateRangeStart);return b},determineEndDate:function(){var b=f.calendarEndDate;"undefined"!==typeof f.roundtripDateRangeEnd&&(b=f.roundtripDateRangeEnd);return b},updateDatePickerRangeData:function(b){var a=b.find(p.datepickerEnabledDates);if(0!==a.length){var c=a.first().data();a=a.last().data();c=(new g).setFullYear(c.year).setMonth(c.month).setDate(c.day);y(c)&&c.addDays(1);c=c.toString("yyyy-MM-dd");a=(new g).setFullYear(a.year).setMonth(a.month).setDate(a.day).toString("yyyy-MM-dd");if("undefined"!==typeof c&&"undefined"!==typeof a){if(n(b)&&d(b)&&!z()){var l=q.getMaxRoundtripDateRangeDays(60);var m=A();if(!y(m)){var r=m.diffDays(a);r=r<=l?a:m.clone().addDays(l).toString("yyyy-MM-dd");var D=m.toString("yyyy-MM-dd")}}f.roundtripDateRangeStart=D;f.roundtripDateRangeEnd=r;f.isOutboundDatePickerEmpty=z();f.calendarStartDate=c;f.calendarEndDate=a;f.isDatePickerOneWayPricing=-1!==p.onewayDatepickerWrappers.indexOf(b[0].id)||u(b);f.isDatePickerInboundWithRoundtripPricing=n(b)&&d(b);f.isDatePickerOutboundWithRoundtripPricing=x(b)&&d(b);f.isDatePickerOutboundWithOnewayPricing=x(b)&&u(b);f.isDatePickerInboundWithOnewayPricing=n(b)&&u(b);f.isRoundtripFareCalendar=u(b)||d(b);f.isDatePickerInbound=n(b);f.isDatePickerOutbound=x(b);f.isDatePickerOneWay=-1!==p.onewayDatepickerWrappers.indexOf(b[0].id);h.publish("fareCalendarParameterModelUpdated",b)}}},pageTypeAbbreviation:l()}});define("fareCalendarRequestBuilder",["storefrontPageModel"],function(a){return function(c){var h=a.userInteraction.context,m=h.site,g=m.brandId+".CalendarGrid",q=h.clientInfo.ipAddress;h=h.user.guid;c={MessageHeader:{MessageVersion:"1.0",CreateDateTime:(new Date).toISOString(),MessageGUID:h,TransactionGUID:h,ClientInfo:{DirectClientIP:q,DirectClientHostname:window.location.hostname,DirectClientName:g,OriginalClientIP:q,OriginalClientHostname:window.location.hostname,OriginalClientName:g}},AirOfferContext:{LegacySiteKey:{TPID:m.siteId,EAPID:m.eapid},PointOfSaleKey:{JurisdictionCountryCode:m.jurisdictionCode,CompanyCode:m.companyCode,ManagementUnitCode:m.managementUnitCode}},OriginLocationCodeList:{LocationCode:[c.origin]},DestinationLocationCodeList:{LocationCode:[c.destination]},Strategy:{FareCalendarRequest:{CalendarStartDate:c.determineStartDate(),CalendarEndDate:c.determineEndDate(),OneWay:c.isDatePickerOneWayPricing,OutboundDateSelected:c.isDatePickerInboundWithRoundtripPricing},FareCalendarStrategy:!0},CacheOnly:!0,TravelerCountList:{TravelerCount:[{TravelerCategoryCode:"adult",Count:1}]},IncludeWhiteLabel:!0};return JSON.stringify(c)}});
define("FareCalendarService",["fareCalendarRequestBuilder"],function(a){var c={config:{endpointUrl:"/flights/farecalendar/v3",payload:a},actions:{isValidResponse:function(a){return a.hasOwnProperty("FlightOfferSummaryList")}},getPricesPromise:function(a){var h=$.Deferred(),g=c.config.payload(a);$.ajax({type:"POST",contentType:"application/json; charset\x3dutf-8",url:c.config.endpointUrl,dataType:"json",data:g}).done(function(a){c.actions.isValidResponse(a)&&h.resolve({priceMap:a})}).fail(function(a,d,m){h.reject({errorThrown:m,url:c.config.endpointUrl,payload:g,status:d})});return h.promise()}};return c});
//# sourceMappingURL=fareCalendarDatePicker-1-en_US.js.map