define("sfAbTest",["jquery","storefrontPageModel","cookies"],function(n,k,l){function m(){return-1<window.location.hostname.indexOf("localhost")||-1<window.location.hostname.indexOf("sandbox.dev")}function p(a){var c=l.get("abov"),b={experiments:[{id:a,value:0}],id:a,value:0};if("string"!==typeof c||0===c.length)return b;c=c.split(/[^\d]/);a=parseInt(a,10);for(var d,f,e=0;e<c.length-2;e+=3)if(d=parseInt(c[e],10),f=parseInt(c[e+2],10),d===a)return{experiments:[{id:d,value:f}],id:d,value:f};return b}var g=k.guid,h=k.userInteraction.context.site.tpid,q=k.userInteraction.context.site.eapid;return{_loggedTests:[],_forcedOverrides:{},get:function(a,c,b){try{var d=n.Deferred();if(m()){var f=p(a);if("function"===typeof b)b(f);else return d.resolve(f)}else if(g&&h&&a){if(c)if("function"===typeof b)this.log(a,b);else return this.log(a,b);else if(require("dctk/dctk",function(e){e.onReady(function(){e.evaluateExperiment({id:"string"===typeof a?parseInt(a,10):a,tpid:h,eapid:q,guid:g,callback:function(a){if(a&&a.error&&a.error.message)if("4301"===a.error.message.substr(0,4))d.reject(a);else{var e={notes:"sfAbTest/get"};a.experiments&&a.experiments[0]&&(e.ab=a.experiments[0].id);window.logError("sfError",a.error,e);void 0===b&&d.reject(a)}else"function"===typeof b?b(a):d.resolve(a)}})})}),void 0===b)return d.promise();if(m()&&this._forcedOverrides.id&&this._forcedOverrides.value)return this._forcedOverrides}}catch(e){window.logError("sfError",e,{notes:"sfAbTest"})}},log:function(a,c){var b=n.Deferred();if(m()){var d=p(a);if("function"===typeof c)c(d);else return b.resolve(d)}else if(g&&h&&a&&(require("dctk/dctk",function(d){d.onReady(function(){d.evaluateExperimentAndLog({id:"string"===typeof a?parseInt(a,10):a,tpid:h,eapid:q,guid:g,callback:function(a){if(a&&a.error&&a.error.message){if("4301"!==a.error.message.substr(0,4)){var d={notes:"sfAbTest/log"};a.experiments&&a.experiments[0]&&(d.ab=a.experiments[0].id);window.logError("sfError",a.error,d);void 0===c&&b.reject(a)}}else"function"===typeof c?c(a):b.resolve(a)}})})}),void 0===c))return b.promise()},override:function(a,c){this._forcedOverrides.id=a;this._forcedOverrides.value=c;var b=[a,"0",c].join("|");b=_.compact([l.get("abov"),b]).join(":");l.set("abov",b)}}});
//# sourceMappingURL=metrics.js.map